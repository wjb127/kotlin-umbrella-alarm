# ☂️ 우산 알림 앱 설정 가이드

## 🌧️ 완성된 기능들

✅ **외부 날씨 API 연동** (OpenWeatherMap API)
✅ **비 오는 날 자동 감지**
✅ **6시부터 우산 알림 발송**
✅ **백그라운드 날씨 체크** (2시간마다)
✅ **위치 기반 날씨 정보**
✅ **스마트 알림 시스템** (1시간에 한 번만)

---

## 🛠️ 당신이 해야 할 일들

### 1. 📋 OpenWeatherMap API 키 발급 **(필수)**

#### 1.1 회원가입 및 API 키 발급
1. [OpenWeatherMap](https://openweathermap.org/api) 사이트 방문
2. **Sign up** 클릭하여 무료 계정 생성
3. 이메일 인증 완료
4. 로그인 후 **My API Keys** 메뉴 이동
5. **API Key** 복사 (예: `abcd1234efgh5678ijkl9012mnop3456`)

#### 1.2 API 키 제한사항
- **무료 플랜**: 1,000회/일 호출 가능
- **활성화 시간**: 발급 후 약 2시간 후 활성화
- **충분한 용량**: 하루 12번 체크 (2시간마다) = 12회 사용

### 2. 📱 앱에서 API 키 설정

앱 실행 후 다음과 같이 설정하세요:

```kotlin
// PreferencesManager를 통해 API 키 저장
preferencesManager.setWeatherApiKey("여기에_발급받은_API키_입력")

// 우산 알림 서비스 시작
umbrellaNotificationService.startUmbrellaNotifications("여기에_발급받은_API키_입력")
```

### 3. 📲 앱 권한 허용 **(필수)**

앱 설치 후 다음 권한들을 **모두 허용**해주세요:

#### 3.1 필수 권한들
- ✅ **위치 권한** (정확한 위치): 현재 위치 기반 날씨 정보
- ✅ **알림 권한**: 우산 챙기라는 알림 받기
- ✅ **백그라운드 실행 권한**: 앱이 닫혀있어도 날씨 체크

#### 3.2 권한 허용 방법
1. **설정** > **앱** > **우산 알림** 
2. **권한** 메뉴 진입
3. **위치**, **알림** 권한을 **허용**으로 설정
4. **배터리** > **백그라운드 활동** 허용

### 4. 🔔 알림 설정 최적화

#### 4.1 배터리 최적화 해제
1. **설정** > **배터리** > **배터리 최적화**
2. **우산 알림** 앱 찾기
3. **최적화하지 않음** 선택

#### 4.2 자동 시작 허용 (제조사별)
- **삼성**: 설정 > 디바이스 케어 > 배터리 > 백그라운드 앱 제한
- **LG**: 설정 > 일반 > 배터리 > 배터리 절약
- **화웨이**: 설정 > 앱 > 고급 > 배터리 최적화 무시

---

## ⚡ 빠른 테스트 방법

### 즉시 날씨 확인하기
```kotlin
// API 키를 설정한 후
umbrellaNotificationService.checkWeatherNow("your_api_key")
```

### 알림 테스트
```kotlin
// 테스트 알림 발송
notificationManager.sendUmbrellaNotification(
    "☂️ 테스트 알림", 
    "우산 알림이 정상적으로 작동합니다!"
)
```

---

## 🎯 알림 작동 방식

### 📅 언제 알림이 오나요?
- **시간**: 오전 6시 ~ 오후 9시
- **주기**: 비가 올 때만, 1시간에 최대 1번
- **조건**: 강수확률 30% 이상 또는 비/눈/뇌우 예보

### 🕐 시간대별 알림 메시지
- **6-8시**: "오늘 비가 올 예정이에요. 출근할 때 우산을 챙기세요!"
- **9-11시**: "곧 비가 올 수 있어요. 외출 시 우산을 준비하세요!"
- **12-17시**: "오후에 비가 올 예정이에요. 우산을 챙기세요!"
- **18-20시**: "퇴근길에 비가 올 수 있어요. 우산을 준비하세요!"

### ⚙️ 커스터마이징 가능한 설정
- **알림 시작/종료 시간**: 기본 6시~21시
- **강수확률 임계값**: 기본 30%
- **알림 활성화/비활성화**: 언제든 on/off 가능

---

## 🔧 고급 설정

### 설정 변경 예시
```kotlin
// 알림 시간 변경 (7시~20시)
preferencesManager.setNotificationStartHour(7)
preferencesManager.setNotificationEndHour(20)

// 강수확률 임계값 변경 (50% 이상일 때만 알림)
preferencesManager.setRainThreshold(50)

// 설정 변경 후 워커 재시작
umbrellaNotificationService.restartWithNewSettings("your_api_key")
```

---

## 📞 문제 해결

### ❌ 알림이 안 와요
1. **API 키 확인**: 올바른 키인지, 활성화되었는지 확인
2. **권한 확인**: 위치, 알림, 백그라운드 권한 모두 허용
3. **배터리 최적화**: 앱이 절전 모드에서 제외되었는지 확인
4. **인터넷 연결**: 데이터 또는 Wi-Fi 연결 상태 확인

### ❌ 위치를 못 찾아요
1. **GPS 켜기**: 설정 > 위치 서비스 활성화
2. **권한 재허용**: 앱 권한에서 위치 권한 다시 허용
3. **Wi-Fi/데이터**: 위치 정확도 향상을 위해 연결 확인

### ❌ 배터리가 많이 소모돼요
- **정상 소모량**: 하루 1-2% 미만
- **최적화**: 2시간마다만 체크하므로 배터리 효율적
- **절약 모드**: 알림 시간대에만 작동

---

## 🎉 설정 완료!

모든 설정이 완료되면 다음과 같이 작동합니다:

1. **2시간마다** 자동으로 날씨 확인
2. **비가 올 예정**이면 우산 알림 발송
3. **6시부터 21시까지** 시간대별 맞춤 메시지
4. **1시간에 1번만** 알림 (스팸 방지)

**이제 비 오는 날 우산을 깜빡하는 일이 없어집니다! ☂️✨** 